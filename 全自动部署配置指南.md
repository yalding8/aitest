# å…¨è‡ªåŠ¨éƒ¨ç½²é…ç½®æŒ‡å— (GitHub Actions)

è¦å®ç° **Local -> GitHub -> Server** çš„å…¨è‡ªåŠ¨ã€å…å¯†æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ GitHub Actionsã€‚

é…ç½®å®Œæˆåï¼Œæ‚¨åªéœ€åœ¨æœ¬åœ°è¿è¡Œ `git push`ï¼ŒGitHub å°±ä¼šè‡ªåŠ¨è¿æ¥æœåŠ¡å™¨å¹¶å®Œæˆæ›´æ–°ã€‚

## 1. å‡†å¤‡ SSH å¯†é’¥

ä¸ºäº†è®© GitHub èƒ½ç™»å½•æ‚¨çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¯¹**æ— å¯†ç **çš„ SSH å¯†é’¥ï¼ˆæˆ–ä½¿ç”¨æ‚¨ç°æœ‰çš„å¯†é’¥ï¼‰ã€‚

### æ–¹æ³• Aï¼šç”Ÿæˆä¸“ç”¨éƒ¨ç½²å¯†é’¥ï¼ˆæ¨èï¼‰
åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œï¼š
```bash
ssh-keygen -t ed25519 -C "github-actions-deploy" -f ./deploy_key -N ""
```
è¿™ä¼šç”Ÿæˆ `deploy_key` (ç§é’¥) å’Œ `deploy_key.pub` (å…¬é’¥)ã€‚

### æ–¹æ³• Bï¼šå°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨
å°†ç”Ÿæˆçš„å…¬é’¥å†…å®¹ (`deploy_key.pub`) è¿½åŠ åˆ°æœåŠ¡å™¨çš„ `authorized_keys` ä¸­ï¼š
```bash
# æŸ¥çœ‹å…¬é’¥å†…å®¹
cat deploy_key.pub

# (æ‰‹åŠ¨ç™»å½•æœåŠ¡å™¨åæ‰§è¡Œ)
# echo "å…¬é’¥å†…å®¹..." >> ~/.ssh/authorized_keys
```

> å¦‚æœæ‚¨æƒ³ç›´æ¥ç”¨ç°æœ‰çš„å¯†é’¥ï¼Œè¯·ç¡®ä¿æ‚¨æœ‰è¯¥å¯†é’¥çš„ç§é’¥å†…å®¹ã€‚

## 2. é…ç½® GitHub Secrets

1. æ‰“å¼€ GitHub ä»“åº“é¡µé¢ã€‚
2. è¿›å…¥ **Settings** -> **Secrets and variables** -> **Actions**ã€‚
3. ç‚¹å‡» **New repository secret**ï¼Œæ·»åŠ ä»¥ä¸‹ä¸‰ä¸ªå˜é‡ï¼š

| Name | Secret Value | è¯´æ˜ |
|------|--------------|------|
| `SERVER_HOST` | `188.166.250.114` | æœåŠ¡å™¨ IP |
| `SERVER_USER` | `root` | ç™»å½•ç”¨æˆ·å |
| `SSH_PRIVATE_KEY` | (æ‚¨çš„ç§é’¥å†…å®¹) | **æ³¨æ„**ï¼šå¤åˆ¶ `deploy_key` æ–‡ä»¶çš„å…¨éƒ¨å†…å®¹ï¼ˆåŒ…å« BEGIN/END è¡Œï¼‰ |
| `GITLAB_REPO` | `gitlab.com/username/repo.git` | GitLab ä»“åº“åœ°å€ï¼ˆä¸å¸¦ `https://`ï¼‰ |
| `GITLAB_TOKEN` | (æ‚¨çš„ Access Token) | æ‹¥æœ‰ Write æƒé™çš„ GitLab Token |

## 3. æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²

1. åœ¨æœ¬åœ°ä¿®æ”¹ä»»æ„æ–‡ä»¶ï¼ˆä¾‹å¦‚ READMEï¼‰ã€‚
2. æäº¤å¹¶æ¨é€ï¼š
   ```bash
   git add .
   git commit -m "feat: test auto deploy"
   git push origin main
   ```
3. è§‚å¯Ÿ GitHub ä»“åº“çš„ **Actions** æ ‡ç­¾é¡µï¼Œæ‚¨åº”è¯¥èƒ½çœ‹åˆ° `Deploy to DigitalOcean` å·¥ä½œæµè‡ªåŠ¨å¼€å§‹è¿è¡Œã€‚

---

## ğŸ’¡ æœ¬åœ°å…å¯†æŠ€å·§ (Optional)

å¦‚æœæ‚¨æƒ³ç»§ç»­ä½¿ç”¨æœ¬åœ°è„šæœ¬ (`./update-server.sh`) ä½†ä¸æƒ³æ¯æ¬¡è¾“å…¥å¯†ç ï¼š

1. **ä½¿ç”¨ ssh-agent**ï¼š
   åœ¨ç»ˆç«¯è¿è¡Œï¼š
   ```bash
   ssh-add /Users/ningding/.ssh/id_ed25519
   ```
   è¾“å…¥ä¸€æ¬¡å¯†ç åï¼Œå½“å‰ä¼šè¯æˆ–ç³»ç»Ÿé‡å¯å‰éƒ½ä¸å†éœ€è¦è¾“å…¥å¯†ç ã€‚

2. **é…ç½® config** (`~/.ssh/config`)ï¼š
   ```
   Host aitest
     HostName 188.166.250.114
     User root
     IdentityFile ~/.ssh/id_ed25519
     UseKeychain yes
     AddKeysToAgent yes
   ```
